<Window x:Class="ConfigStringManager.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:ConfigStringManager"
        Title="Config String Manager" Height="760" Width="1062"
        WindowStartupLocation="CenterScreen"
        ResizeMode="NoResize">
    <Window.Resources>

        <!-- Brushes -->
        <SolidColorBrush x:Key="WindowBackgroundBrush" Color="#EFEFEF"/>
        <SolidColorBrush x:Key="PanelBrush" Color="#E6E6E6"/>
        <SolidColorBrush x:Key="PanelBorderBrush" Color="gray"/>
        <SolidColorBrush x:Key="TextBrush" Color="black"/>
        <SolidColorBrush x:Key="MutedBrush" Color="Black"/>
        <SolidColorBrush x:Key="AccentBrush" Color="Transparent"/>

        <!-- Global TreeView style -->
        <Style TargetType="TreeView">
            <Setter Property="BorderBrush" Value="{StaticResource PanelBorderBrush}"/>
        </Style>

        <Style x:Key="GlobalTreeItemStyle" TargetType="TreeViewItem">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Padding" Value="4,3"/>
            <Style.Triggers>
                <Trigger Property="IsFocused" Value="True">
                    <Setter Property="FontWeight" Value="Bold" />
                    <Setter Property="Background" Value="green" />
                    <Setter Property="Foreground" Value="black" />
                </Trigger>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#E3E3E3"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style TargetType="ComboBox">
            <Setter Property="Foreground" Value="{StaticResource TextBrush}"/>
            <Setter Property="Background" Value="#081014"/>
            <Setter Property="Padding" Value="4"/>
        </Style>
        <Style TargetType="ListBox">
            <Setter Property="Background" Value="white"/>
            <Setter Property="Foreground" Value="{StaticResource TextBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource PanelBorderBrush}"/>
        </Style>

        <StackPanel x:Key="tooltipUpdateAllServers">
            <TextBlock>Update all the servers for the selected file</TextBlock>
            <!--<TextBlock>f2</TextBlock>-->
        </StackPanel>

        <StackPanel x:Key="tooltipCopyFilePath">
            <TextBlock>Copy file path to clipboard</TextBlock>
            <!--<TextBlock>f2</TextBlock>-->
        </StackPanel>

        <!-- TreeViewItem styles used by the StyleSelector -->
        <Style x:Key="EnvStyle" TargetType="TreeViewItem" BasedOn="{StaticResource GlobalTreeItemStyle}">
            <EventSetter Event="Selected" Handler="Env_Selected"/>
        </Style>

        <Style x:Key="AliasStyle" TargetType="TreeViewItem" BasedOn="{StaticResource GlobalTreeItemStyle}">
            <EventSetter Event="Expanded" Handler="Root_Expanded"/>
            <EventSetter Event="Selected" Handler="Root_Selected"/>
        </Style>

        <Style x:Key="ConnStyle" TargetType="TreeViewItem" BasedOn="{StaticResource GlobalTreeItemStyle}">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <EventSetter Event="Selected" Handler="Conn_Selected"/>
            <Style.Triggers>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="LightGray"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="MsgStyle" TargetType="TreeViewItem" BasedOn="{StaticResource GlobalTreeItemStyle}">
        </Style>

        <Style TargetType="ComboBox" x:Key="EditableComboFix">
            <Setter Property="IsEditable" Value="True"/>
            <Setter Property="MinHeight" Value="28"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ComboBox">
                        <Grid>
                            <ToggleButton Name="ToggleButton"
                                  Grid.Column="2"
                                  Focusable="False"
                                  IsChecked="{Binding IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"
                                  ClickMode="Press">
                                <Path Fill="Black" Data="M 0 0 L 4 4 L 8 0 Z"/>
                            </ToggleButton>

                            <ContentPresenter Name="ContentSite"
                                      IsHitTestVisible="False"
                                      Content="{TemplateBinding SelectionBoxItem}"
                                      ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}"
                                      ContentTemplateSelector="{TemplateBinding ItemTemplateSelector}"
                                      Margin="3,3,23,3"
                                      VerticalAlignment="Center"/>

                            <TextBox Name="PART_EditableTextBox"
                             Margin="3,3,23,3"
                             VerticalContentAlignment="Center"
                             MinHeight="24"
                             Background="Transparent"
                             Visibility="Hidden"
                             IsReadOnly="{TemplateBinding IsReadOnly}"/>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Style selector -->
        <local:TreeViewStyleSelector x:Key="TreeViewSelector"
                                 EnvStyle="{StaticResource EnvStyle}"
                                 AliasStyle="{StaticResource AliasStyle}"
                                 ConnStyle="{StaticResource ConnStyle}"
                                 MsgStyle="{StaticResource MsgStyle}"/>

    </Window.Resources>


    <Grid Background="{StaticResource WindowBackgroundBrush}" Margin="12,12,10,12">

       
        <!-- LEFT: Files Tree -->
        <Border Grid.Column="0" Background="{StaticResource PanelBrush}" BorderBrush="{StaticResource PanelBorderBrush}" BorderThickness="1" CornerRadius="8" Padding="2" Margin="0,0,530,0">
            <DockPanel>
                <StackPanel>
                    <Button x:Name="btnReloadFiles" Content="Reload Files" Click="BtnReloadFiles_Click" Margin="10,3" Padding="6,4" HorizontalAlignment="Left"/>
                    <!--<TreeView x:Name="FilesTree" Width="470" Height="600" Margin="5" />-->

                    <TreeView x:Name="FilesTree"
                      Width="470"
                      Height="600"
                      Margin="5"
                      ItemsSource="{Binding DevEnvs}"
                      
                      ScrollViewer.VerticalScrollBarVisibility="Auto"
                      ItemContainerStyleSelector="{StaticResource TreeViewSelector}">
                        <!--ScrollViewer.HorizontalScrollBarVisibility="Disabled"-->
                        
                        <TreeView.Resources>

                            <!--<Style TargetType="TreeViewItem">
                                <Setter Property="Foreground" Value="{Binding Foreground}"/>
                                --><!--<Setter Property="Background" Value="Transparent"/>--><!--
                                <Style.Triggers>
                                    <Trigger Property="IsSelected" Value="True">
                                        --><!--<Setter Property="Background" Value="#c9c9c9"/>--><!--
                                        <Setter Property="Foreground" Value="Black"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>-->

                            <SolidColorBrush x:Key="{x:Static SystemColors.HighlightBrushKey}"
                                Color="#c9c9c9" />
                            <!--<SolidColorBrush x:Key="{x:Static SystemColors.HighlightTextBrushKey}"
                                Color="green" />-->
                            <!--<SolidColorBrush x:Key="{x:Static SystemColors.InactiveSelectionHighlightBrushKey}"
                                Color="#c9c9c9" />-->
                            <!--<SolidColorBrush x:Key="{x:Static SystemColors.InactiveSelectionHighlightTextBrushKey}"
                                Color="black" />-->

                            <SolidColorBrush x:Key="{x:Static SystemColors.ControlTextBrushKey}" Color="Black"/>
                            <!--<SolidColorBrush x:Key="{x:Static SystemColors.WindowBrushKey}" Color="lightblue"/>-->


                            <!-- DevEnvironment -->
                            <HierarchicalDataTemplate DataType="{x:Type local:DevEnvironment}"
                                  ItemsSource="{Binding Files}">
                                <TextBlock Text="{Binding Name}"
                                   FontSize="16"
                                   TextWrapping="Wrap"
                                   TextTrimming="CharacterEllipsis"/>
                            </HierarchicalDataTemplate>

                            <!-- AliasItem -->
                            <HierarchicalDataTemplate DataType="{x:Type local:AliasItem}"
                                  ItemsSource="{Binding Children}">
                                <TextBlock Text="{Binding Alias}"
                                    FontSize="14"
                                    TextWrapping="Wrap"
                                    TextTrimming="CharacterEllipsis"/>
                            </HierarchicalDataTemplate>

                            <!-- ConnectionEntry -->
                            <DataTemplate DataType="{x:Type local:ConnectionEntry}">
                                <TextBlock Text="{Binding Name}"
                                   FontSize="12"
                                   TextWrapping="Wrap"
                                   TextTrimming="CharacterEllipsis"                                           
                                   Foreground="{Binding Foreground}"
                                   FontWeight="{Binding FontWeight}"/>
                            </DataTemplate>

                            <!-- MissingFileMessage -->
                            <DataTemplate DataType="{x:Type local:MissingFileMessage}">
                                <TextBlock Text="{Binding Message}"
                                   TextWrapping="Wrap"
                                   Foreground="Red"/>
                            </DataTemplate>

                        </TreeView.Resources>

                    </TreeView>

                    <TextBlock Text="Connection string extracted from SystemWeb-SessionState" FontWeight="Bold" Foreground="DarkGreen" TextWrapping="Wrap" FontSize="10" Width="453"/>
                    <TextBlock Text="Connection string extracted from AppSettings" FontWeight="Bold" Foreground="BlueViolet" TextWrapping="Wrap" FontSize="10" Width="456"/>
                    <TextBlock Text="Connection string extracted from ProfilerConsumer" FontWeight="Bold" Foreground="DarkBlue" TextWrapping="Wrap" FontSize="10" Width="456"/>
                </StackPanel>
            </DockPanel>
        </Border>

        <!-- CENTER: Connection editor -->
        <Border Background="{StaticResource PanelBrush}" BorderBrush="{StaticResource PanelBorderBrush}" BorderThickness="1" CornerRadius="8" Padding="14" Margin="500,-2,1,2">
            <Border.RenderTransform>
                <TransformGroup>
                    <ScaleTransform/>
                    <SkewTransform AngleY="0.32"/>
                    <RotateTransform/>
                    <TranslateTransform Y="1.034"/>
                </TransformGroup>
            </Border.RenderTransform>
            <StackPanel>
               
                <!--Message Panel-->
                <StackPanel x:Name="StatusMessagePanel" Orientation="Horizontal" Visibility="Collapsed" Margin="0,0,0,8">
                    <TextBlock x:Name="StatusMessage" Text="" Foreground="DarkOrange" FontWeight="Bold"/>
                </StackPanel>

                <StackPanel x:Name="DbLoadingPanel" Orientation="Horizontal" Visibility="Collapsed" Margin="0,0,0,8">
                    <ProgressBar IsIndeterminate="True" Width="120" Height="12" Margin="0,0,10,0"/>
                    <TextBlock Text="Loading databases..." VerticalAlignment="Center" Foreground="DarkOrange"/>
                </StackPanel>

                <TextBlock Text="Edit Selected" Foreground="{StaticResource MutedBrush}" FontWeight="SemiBold" Margin="0,0,0,8"/>

                <StackPanel x:Name="AliasPanel" Visibility="Collapsed">
                    <Separator Margin="0,4,0,8"/>
                    <!-- Alias edit row -->
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="0,0,0,8">
                        <StackPanel Width="70">
                            <TextBlock Text="Alias" Foreground="{StaticResource MutedBrush}"/>
                        </StackPanel>
                        <TextBlock x:Name="AliasBox" MinWidth="300" Width="140" />
                    </StackPanel>

                    <!-- File path -->
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,12" >
                        <StackPanel Width="70">
                            <TextBlock x:Name="lblFile" Text="File" Foreground="{StaticResource MutedBrush}" />
                        </StackPanel>
                        <TextBlock x:Name="FilePathText" Foreground="{StaticResource TextBrush}" TextWrapping="Wrap" MinWidth="300" MaxWidth="300"/>
                        <Button x:Name="btnCopyText" Click="BtnCopyFilePath_Click" Content="Copy" Background="{StaticResource PanelBrush}" Foreground="Black" Padding="8,6" Margin="0"
                                ToolTip="{StaticResource tooltipCopyFilePath}"/>
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8" ToolTip="{StaticResource tooltipUpdateAllServers}">
                        <StackPanel Width="70">
                            <TextBlock Text="Server" Foreground="{StaticResource MutedBrush}" />
                        </StackPanel>
                        <ComboBox x:Name="FileServersCombo" MinWidth="300" IsEditable="False" />
                        <Button x:Name="btnUpdateFileServers" Click="BtnUpdateServersOnFile_Click" Content="Update" Background="{StaticResource PanelBrush}" Foreground="Black" Padding="8,6" Margin="0"/>

                    </StackPanel>
                    <!--<StackPanel x:Name="StatusTextFileServersPanel">
                        <TextBlock x:Name="StatusTextFileServers" Foreground="DarkRed" FontWeight="Bold" Margin="10,6,0,0"/>
                    </StackPanel>-->

                </StackPanel>

                <Separator Margin="0,4,0,8"/>

                <StackPanel x:Name="ConnStringsPanel" Visibility="Collapsed">
                   
                  
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">

                        <StackPanel Width="70">
                            <TextBlock Text="Name" Foreground="{StaticResource MutedBrush}"/>
                        </StackPanel>
                        <TextBlock x:Name="ConnNameText" Foreground="{StaticResource TextBrush}" VerticalAlignment="Center"/>
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                        <StackPanel Width="70">
                            <TextBlock Text="Server" Foreground="{StaticResource MutedBrush}"/>
                        </StackPanel>
                        <ComboBox x:Name="ServerCombo" MinWidth="300" IsEditable="False" SelectionChanged="ServerCombo_SelectionChanged"/>
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                        <StackPanel Width="70">
                            <TextBlock Text="Database" Foreground="{StaticResource MutedBrush}"/>
                        </StackPanel>
                        <ComboBox x:Name="DatabaseCombo" MinWidth="300" MinHeight="28" IsEditable="true" IsTextSearchEnabled="True"  MaxDropDownHeight="Auto" 
                                  SelectionChanged="DatabaseCombo_SelectionChanged"></ComboBox>
                    </StackPanel>

                    <StackPanel Orientation="Horizontal">
                        <Button x:Name="btnSaveChanges"  Content="Save Changes" Click="BtnSaveConn_Click" Background="{StaticResource PanelBrush}" Foreground="Black" Padding="8,6"/>
                        <!--<TextBlock x:Name="StatusText" Foreground="darkred" FontWeight="Bold" Margin="10,6,0,0"/>-->
                    </StackPanel>
                  

                </StackPanel>
            </StackPanel>
        </Border>
    </Grid>
</Window>
